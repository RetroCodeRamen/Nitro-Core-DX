-- Dev Kit Compile+Run Color Test (CoreLX)
-- Purpose: visible end-to-end CoreLX compile -> ROM -> embedded emulator validation
-- Controls:
--   Z = cycle background color

function Start()
    ppu.enable_display()

    color_mode := 0
    prev_buttons := 0

    -- Set initial visible background color (palette 0, color 0)
    gfx.set_palette(0, 0, 0x001F)  -- Blue

    while true
        wait_vblank()

        buttons := input.read(0)

        if (buttons & 0x10) != 0 and (prev_buttons & 0x10) == 0
            color_mode = color_mode + 1
            if color_mode >= 4
                color_mode = 0

            if color_mode == 0
                gfx.set_palette(0, 0, 0x001F)  -- Blue
            if color_mode == 1
                gfx.set_palette(0, 0, 0x03E0)  -- Green
            if color_mode == 2
                gfx.set_palette(0, 0, 0x7C00)  -- Red
            if color_mode == 3
                gfx.set_palette(0, 0, 0x7FFF)  -- White

        prev_buttons = buttons
